<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>News & Research | AILab</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(180deg,#DFF0F9 25%,#E5F4FF 75%); overflow-x: hidden; scroll-behavior: smooth; }
    /* Fade helpers */
    .fade-up { opacity:0; transform: translateY(30px); transition: all .6s ease; }
    .fade-up.show { opacity:1; transform: translateY(0); }
    .fade-section { opacity:0; transform: translateY(20px); transition: opacity .45s ease, transform .45s ease; }
    .fade-section.show { opacity:1; transform: translateY(0); }
    /* Navbar */
    .navbar { position: fixed; top:0; width:100%; z-index:50; transition: .4s; background: transparent; }
    .navbar.scrolled { background: rgba(255,255,255,.92); backdrop-filter: blur(10px); box-shadow: 0 2px 12px rgba(0,0,0,.08); }
    /* small visual tweak for active filter */
    .filter-btn.active { background:#f97316; color:white; box-shadow: 0 6px 18px rgba(249,115,22,.16); }
    footer { background:#016B93; }
  </style>
</head>
<body>

  <!-- NAV -->
  <nav class="navbar">
    <div class="max-w-7xl mx-auto flex items-center justify-between py-4 px-8">
      <img src="img/logorm.png" alt="logo" class="w-40">
      <ul class="hidden md:flex gap-8 text-lg font-medium">
        <li><a href="index.html" class="nav-link">Home</a></li>
        <li><a href="about.html" class="nav-link">About</a></li>
        <li><a href="research.html" class="nav-link">Research</a></li>
        <li><a href="activity.html" class="nav-link">Activity</a></li>
        <li><a href="members.html" class="nav-link">Members</a></li>
        <li><a href="facility.html" class="nav-link">Facility</a></li>
        <li><a href="contact.html" class="nav-link">Contact</a></li>
      </ul>
    </div>
  </nav>

  <!-- HEADER + FILTER -->
  <header class="pt-32 pb-8">
    <div class="max-w-5xl mx-auto text-center fade-up" id="pageHeader">
      <h1 class="text-5xl font-semibold text-gray-900">News & Research Highlights</h1>
      <p class="mt-4 text-xl text-gray-700">Explore the latest breakthroughs, innovations, and collaborations from Applied Informatics Lab where technology meets real-world impact.</p>

      <!-- FILTER -->
      <div class="flex justify-center gap-6 mt-8 flex-wrap" id="filterButtons">
        <button data-filter="all" class="filter-btn px-6 py-2 rounded-full text-lg">All</button>
        <button data-filter="research" class="filter-btn px-2 py-2 text-lg">Research</button>
        <button data-filter="innovation" class="filter-btn px-2 py-2 text-lg">Innovation</button>
        <button data-filter="collaboration" class="filter-btn px-2 py-2 text-lg">Collaboration</button>
        <button data-filter="award" class="filter-btn px-2 py-2 text-lg">Award</button>
      </div>
    </div>
  </header>

  <!-- NEWS GRID -->
  <main class="max-w-7xl mx-auto px-8 mb-24">
    <section id="newsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 fade-up" aria-live="polite"></section>
  </main>

  <!-- Card template (single) -->
  <template id="newsCardTemplate">
    <article class="news-card bg-white rounded-3xl shadow-md overflow-hidden hover:shadow-xl transition transform cursor-pointer">
      <img class="card-img w-full h-52 object-cover" src="" alt="news image">
      <div class="p-4">
        <h3 class="card-title font-bold text-lg text-gray-900"></h3>
        <p class="card-date text-gray-600 text-base mt-1"></p>
      </div>
    </article>
  </template>

  <!-- DETAIL SECTION (hidden initially) -->
  <section id="newsDetail" class="hidden bg-white/60 py-20 px-10 fade-section">
    <div class="max-w-7xl mx-auto">
      <button id="backBtn" class="mb-6 px-5 py-2 bg-orange-500 text-white rounded-full shadow-md hover:bg-orange-600">← Back to News</button>

      <h2 class="text-5xl font-semibold mb-3">News Detail</h2>
      <p id="breadcrumb" class="text-lg text-gray-700 mb-6">News &gt; Research &gt; ...</p>

      <div class="w-full flex justify-center mb-10">
        <img id="detailImg" src="img/newsdown.png" class="w-[95%] max-w-[1200px] h-[330px] object-cover rounded-[30px] shadow-md" alt="detail image">
      </div>

      <h3 id="detailTitle" class="text-4xl font-semibold mb-1">Title</h3>
      <p id="detailDate" class="text-gray-600 text-xl mb-8">October, 2024</p>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-10 items-start">
        <div class="col-span-2">
          <p id="detailBody" class="text-gray-800 text-lg leading-relaxed">
          Article content...
          </p>
        </div>

        <div class="relative">
          <div class="border-2 border-sky-700 rounded-2xl p-6 bg-white/70 shadow-md">
            <span class="absolute text-cyan-700 text-6xl top-[20px] left-4">“</span>
            <p id="detailQuote" class="text-gray-800 text-lg leading-relaxed mt-6"></p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="text-white py-8 mt-16">
    <div class="max-w-6xl mx-auto px-6 grid md:grid-cols-3 gap-8 text-center md:text-left">
      <div>
        <img src="img/logowhite.png" class="mx-auto md:mx-0 w-40 mb-4" alt="white logo">
        <p class="text-sm text-blue-100">AI Lab Polinema — a collaborative innovation hub advancing applied informatics.</p>
      </div>
      <div>
        <h3 class="font-semibold text-lg mb-3">Quick Links</h3>
        <ul class="space-y-2 text-blue-100">
          <li><a href="index.html" class="hover:text-white">Home</a></li>
          <li><a href="about.html" class="hover:text-white">About</a></li>
          <li><a href="research.html" class="hover:text-white">Research</a></li>
          <li><a href="contact.html" class="hover:text-white">Contact</a></li>
        </ul>
      </div>
      <div>
        <h3 class="font-semibold text-lg mb-3">Contact Us</h3>
        <p class="text-blue-100 text-sm">Gedung Pascasarjana Lt. 2,<br>Politeknik Negeri Malang<br>Email: <a href="mailto:ailab@polinema.ac.id" class="underline text-white">ailab@polinema.ac.id</a></p>
      </div>
    </div>
    <div class="border-t border-blue-300 mt-8 pt-4 text-center text-blue-100 text-sm">© 2025 AI Lab Polinema. All rights reserved.</div>
  </footer>

  <!-- SCRIPTS -->
  <script>
const apiBase = "http://127.0.0.1:8000/api";

const gridEl = document.getElementById('newsGrid');
const tpl = document.getElementById('newsCardTemplate').content;
const filterBtns = document.querySelectorAll('.filter-btn');
const detailSection = document.getElementById('newsDetail');
const backBtn = document.getElementById('backBtn');

/* ============================
   FETCH DATA
============================ */
async function fetchNews(category = 'all') {
  try {
    const url = new URL(apiBase + '/news');
    if (category !== "all") url.searchParams.set('category', category);

    const res = await fetch(url);
    if (!res.ok) throw new Error("Failed to fetch news");

    return await res.json();
  } catch (e) {
    console.error(e);
    return [];
  }
}

async function fetchOne(id) {
  try {
    const res = await fetch(apiBase + '/news/' + id);
    if (!res.ok) throw new Error("Not found");
    return await res.json();
  } catch (e) {
    console.error(e);
    return null;
  }
}

/* ============================
   RENDER LIST
============================ */
function renderGrid(items = []) {
  gridEl.innerHTML = "";

  if (!items.length) {
    gridEl.innerHTML = `<p class="text-center text-gray-600 col-span-full">No news available.</p>`;
    return;
  }

  items.forEach(item => {
    const card = tpl.cloneNode(true);
    const el = card.querySelector('.news-card');

    el.dataset.id = item.id;

    card.querySelector('.card-img').src = item.image_thumb || "img/newstop.png";
    card.querySelector('.card-title').textContent = item.title;
    card.querySelector('.card-date').textContent =
      item.date ? new Date(item.date).toLocaleDateString() : "";

    el.addEventListener('click', () => openDetail(item.id));

    gridEl.appendChild(card);
  });
}

/* ============================
   DETAIL VIEW
============================ */
async function openDetail(id) {
  const item = await fetchOne(id);
  if (!item) return alert("Failed to load detail");

  document.getElementById("breadcrumb").textContent =
    `News > ${capitalize(item.category || "")} > ${item.title}`;

  document.getElementById("detailTitle").textContent = item.title;
  document.getElementById("detailDate").textContent =
    item.date ? new Date(item.date).toLocaleDateString() : "";

  document.getElementById("detailImg").src =
    item.image_detail || item.image_thumb || "img/newsdown.png";

  document.getElementById("detailBody").innerHTML =
    item.content || item.excerpt || "";

  document.getElementById("detailQuote").textContent = item.quote || "";

  gridEl.parentElement.classList.add("hidden");
  detailSection.classList.remove("hidden");

  setTimeout(() => detailSection.classList.add("show"), 25);
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function backToGrid() {
  detailSection.classList.remove("show");
  setTimeout(() => {
    detailSection.classList.add("hidden");
    gridEl.parentElement.classList.remove("hidden");
    window.scrollTo({ top: 0, behavior: "smooth" });
  }, 300);
}

/* ============================
   HELPERS
============================ */
function capitalize(s) {
  if (!s) return "";
  return s.charAt(0).toUpperCase() + s.slice(1);
}

/* ============================
   INIT
============================ */
document.addEventListener("DOMContentLoaded", async () => {
  const allNews = await fetchNews("all");
  renderGrid(allNews);

  const allBtn = document.querySelector('[data-filter="all"]');
  if (allBtn) allBtn.classList.add("active");

  filterBtns.forEach(btn => {
    btn.addEventListener("click", async () => {
      filterBtns.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      const cat = btn.dataset.filter || "all";
      const items = await fetchNews(cat);
      renderGrid(items);
    });
  });

  backBtn.addEventListener("click", backToGrid);

  const fadeEls = document.querySelectorAll(".fade-up");
  const reveal = () => {
    fadeEls.forEach(el => {
      if (el.getBoundingClientRect().top < window.innerHeight - 80) {
        el.classList.add("show");
      }
    });
  };
  window.addEventListener("scroll", reveal);
  reveal();

  const navbar = document.querySelector(".navbar");
  window.addEventListener("scroll", () => {
    navbar.classList.toggle("scrolled", window.scrollY > 20);
  });
});
</script>
</body>
</html>
